<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>30 Day Weather & Grid Forecast</title>
<meta name="description" content="30-day ISO load forecast + 30-day daily high/low weather outlook with short-range forecast and climatology fill." />
<style>
  :root{--bg:#0b0f17;--fg:#e8ecf3;--muted:#9aa7b1;--card:#111726;--accent:#4ea1ff}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid #1e2535;flex-wrap:wrap}
  h1{font-size:1.05rem;margin:0}
  .meta{color:var(--muted);font-size:.9rem}
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  select,input,button{background:#0e1524;color:var(--fg);border:1px solid #20304b;border-radius:10px;padding:8px 10px}
  button{cursor:pointer}
  main{padding:16px}
  .grid{display:grid;gap:16px}
  @media(min-width:1100px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:var(--card);border:1px solid #1b2334;border-radius:16px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  .title{font-weight:600;margin:0 0 8px 0}
  #statusLoad,#statusWx{font-size:.9rem;color:var(--muted);margin-top:8px;min-height:1.4em;white-space:pre-wrap}
  canvas{width:100%;height:280px;display:block} /* reduced height */
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
<header>
  <div>
    <h1>30 Day Weather & Grid Forecast</h1>
    <div class="meta">ISO: 30-day DF forecast (dotted orange) with 3-yr climatology fill. Weather: 30-day daily high/low — short-range forecast, then 3-yr same-date average.</div>
  </div>
  <div class="controls">
    <label>ISO
      <select id="isoSelect">
        <option value="CISO">CAISO</option><option value="PJM">PJM</option>
        <option value="MISO">MISO</option><option value="SPP">SPP</option>
        <option value="ISNE">ISO-NE</option><option value="NYIS">NYISO</option>
        <option value="ERCO">ERCOT</option>
      </select>
    </label>
    <label>ZIP
      <input id="zipInput" type="text" placeholder="e.g., 90012" value="90012" />
    </label>
    <button id="runBtn">Run</button>
  </div>
</header>

<main>
  <div class="grid">
    <div class="card">
      <p class="title">ISO Load — 30-Day Forecast</p>
      <canvas id="loadChart"></canvas>
      <div id="statusLoad">Ready.</div>
    </div>
    <div class="card">
      <p class="title">Weather — 30-Day Daily High/Low</p>
      <canvas id="wxChart"></canvas>
      <div id="statusWx">Ready.</div>
    </div>
  </div>
</main>

<script>
/* ... keep all your fetch + build functions exactly as in last version ... */

/* =========================
   Charts
========================= */
let loadChart, wxChart;
function makeLoadChart(ctx){
  return new Chart(ctx,{
    type:"line",
    data:{labels:[], datasets:[
      {
        label:"Forecast Load (MW)", 
        data:[], 
        borderWidth:2, 
        pointRadius:0, 
        borderColor:"#ffa500", 
        borderDash:[4,4],
        // ensure legend symbol matches (dotted orange line)
        borderCapStyle:"butt"
      }
    ]},
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{ 
        legend:{ 
          labels:{ 
            color:"#dbe6f2", 
            usePointStyle:false, 
            generateLabels: function(chart){
              const ds = chart.data.datasets;
              return ds.map((d,i)=>({
                text: d.label,
                fillStyle: d.borderColor,
                strokeStyle: d.borderColor,
                lineDash: d.borderDash || [],
                hidden: !chart.isDatasetVisible(i),
                datasetIndex: i
              }));
            }
          } 
        } 
      },
      scales:{
        x:{ type:"category", ticks:{ color:"#b8c2cc", maxRotation:0, autoSkip:true, autoSkipPadding:16 }, grid:{ color:"rgba(255,255,255,0.06)" } },
        y:{ ticks:{ color:"#b8c2cc" }, grid:{ color:"rgba(255,255,255,0.06)" } }
      }
    }
  });
}
function makeWxChart(ctx){
  return new Chart(ctx,{
    type:"line",
    data:{labels:[], datasets:[
      {label:"Daily High (°F)", data:[], borderWidth:2, pointRadius:0, borderColor:"#ff4d4d"},
      {label:"Daily Low (°F)",  data:[], borderWidth:2, pointRadius:0, borderColor:"#4da6ff", borderDash:[6,6]}
    ]},
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{ legend:{ labels:{ color:"#dbe6f2", usePointStyle:true } } },
      scales:{
        x:{ type:"category", ticks:{ color:"#b8c2cc", maxRotation:0, autoSkip:true, autoSkipPadding:16 }, grid:{ color:"rgba(255,255,255,0.06)" } },
        y:{ ticks:{ color:"#b8c2cc" }, grid:{ color:"rgba(255,255,255,0.06)" } }
      }
    }
  });
}

/* ... keep render() etc. same ... */
</script>
</body>
</html>
